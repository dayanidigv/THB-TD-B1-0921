<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JavaScript Asynchronous Programming</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    .example {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      border-left: 4px solid #fd7e14;
    }
    .output {
      background: #f8f9fa;
      padding: 15px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #dee2e6;
      min-height: 50px;
    }
    button {
      background: #fd7e14;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
      font-size: 14px;
    }
    button:hover {
      background: #e06011;
    }
    .loading {
      color: #6c757d;
      font-style: italic;
    }
    .success {
      color: #28a745;
      font-weight: bold;
    }
    .error {
      color: #dc3545;
      font-weight: bold;
    }
    .code-block {
      background: #f1f3f4;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      margin: 10px 0;
      white-space: pre-wrap;
    }
    .api-result {
      background: #e8f5e8;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>JavaScript Asynchronous Programming</h1>

    <div class="example">
      <h3>1. setTimeout and setInterval</h3>
      <div class="output" id="timeout-output">Click buttons to test timing functions</div>
      <button onclick="testTimeout()">Test setTimeout</button>
      <button onclick="testInterval()">Test setInterval</button>
      <button onclick="clearIntervals()">Clear Intervals</button>
    </div>

    <div class="example">
      <h3>2. Callbacks</h3>
      <div class="output" id="callback-output">Testing callback patterns</div>
      <button onclick="testCallbacks()">Test Callbacks</button>
      <button onclick="testCallbackHell()">Callback Hell Example</button>
    </div>

    <div class="example">
      <h3>3. Promises</h3>
      <div class="output" id="promise-output">Testing Promise patterns</div>
      <button onclick="testPromiseBasics()">Promise Basics</button>
      <button onclick="testPromiseChaining()">Promise Chaining</button>
      <button onclick="testPromiseAll()">Promise.all()</button>
    </div>

    <div class="example">
      <h3>4. Async/Await</h3>
      <div class="output" id="async-output">Testing async/await patterns</div>
      <button onclick="testAsyncBasics()">Async Basics</button>
      <button onclick="testAsyncErrorHandling()">Error Handling</button>
      <button onclick="testParallelExecution()">Parallel Execution</button>
    </div>

    <div class="example">
      <h3>5. Fetch API</h3>
      <div class="output" id="fetch-output">Testing API calls</div>
      <button onclick="testFetchBasics()">Basic Fetch</button>
      <button onclick="testFetchWithOptions()">Fetch with Options</button>
      <button onclick="testFetchErrorHandling()">Error Handling</button>
    </div>

    <div class="example">
      <h3>6. Real-world Example: User Data Manager</h3>
      <div class="output" id="realworld-output">
        <div>
          <input type="number" id="user-id" placeholder="Enter user ID (1-10)" min="1" max="10">
          <button onclick="fetchUserData()">Fetch User Data</button>
          <button onclick="fetchMultipleUsers()">Fetch Multiple Users</button>
        </div>
        <div id="user-results"></div>
      </div>
    </div>
  </div>

  <script>
    let intervalIds = [];

    // 1. setTimeout and setInterval
    function testTimeout() {
      const output = document.getElementById('timeout-output');
      output.innerHTML = '<span class="loading">Waiting 2 seconds...</span>';
      
      setTimeout(() => {
        output.innerHTML = '<span class="success">setTimeout executed after 2 seconds!</span>';
      }, 2000);
    }

    function testInterval() {
      const output = document.getElementById('timeout-output');
      let count = 0;
      
      const intervalId = setInterval(() => {
        count++;
        output.innerHTML = `<span class="loading">Interval count: ${count}</span>`;
        
        if (count >= 5) {
          clearInterval(intervalId);
          output.innerHTML += '<br><span class="success">Interval stopped after 5 executions</span>';
        }
      }, 1000);
      
      intervalIds.push(intervalId);
    }

    function clearIntervals() {
      intervalIds.forEach(id => clearInterval(id));
      intervalIds = [];
      document.getElementById('timeout-output').innerHTML = '<span class="success">All intervals cleared</span>';
    }

    // 2. Callbacks
    function simulateApiCall(callback, shouldFail = false) {
      setTimeout(() => {
        if (shouldFail) {
          callback(new Error('API call failed'), null);
        } else {
          callback(null, { id: 1, name: 'John Doe', email: 'john@example.com' });
        }
      }, 1500);
    }

    function testCallbacks() {
      const output = document.getElementById('callback-output');
      output.innerHTML = '<span class="loading">Making API call with callback...</span>';
      
      simulateApiCall((error, data) => {
        if (error) {
          output.innerHTML = `<span class="error">Error: ${error.message}</span>`;
        } else {
          output.innerHTML = `<span class="success">Success: ${JSON.stringify(data)}</span>`;
        }
      });
    }

    function testCallbackHell() {
      const output = document.getElementById('callback-output');
      output.innerHTML = '<span class="loading">Demonstrating callback hell...</span>';
      
      // Simulating nested API calls (callback hell)
      setTimeout(() => {
        console.log('Step 1 complete');
        setTimeout(() => {
          console.log('Step 2 complete');
          setTimeout(() => {
            console.log('Step 3 complete');
            output.innerHTML = `
              <span class="error">Callback Hell Example:</span>
              <div class="code-block">setTimeout(() => {
  console.log('Step 1');
  setTimeout(() => {
    console.log('Step 2');
    setTimeout(() => {
      console.log('Step 3');
      // This gets hard to read!
    }, 1000);
  }, 1000);
}, 1000);</div>
            `;
          }, 1000);
        }, 1000);
      }, 1000);
    }

    // 3. Promises
    function createPromise(shouldResolve = true, delay = 1500) {
      return new Promise((resolve, reject) => {
        setTimeout(() => {
          if (shouldResolve) {
            resolve({ id: Math.random(), message: 'Promise resolved!' });
          } else {
            reject(new Error('Promise rejected!'));
          }
        }, delay);
      });
    }

    function testPromiseBasics() {
      const output = document.getElementById('promise-output');
      output.innerHTML = '<span class="loading">Testing basic promise...</span>';
      
      createPromise(true)
        .then(data => {
          output.innerHTML = `<span class="success">Promise resolved: ${JSON.stringify(data)}</span>`;
        })
        .catch(error => {
          output.innerHTML = `<span class="error">Promise rejected: ${error.message}</span>`;
        });
    }

    function testPromiseChaining() {
      const output = document.getElementById('promise-output');
      output.innerHTML = '<span class="loading">Testing promise chaining...</span>';
      
      createPromise(true, 1000)
        .then(data => {
          console.log('First promise:', data);
          return createPromise(true, 1000);
        })
        .then(data => {
          console.log('Second promise:', data);
          return { final: 'All promises completed!' };
        })
        .then(data => {
          output.innerHTML = `<span class="success">Promise chain completed: ${JSON.stringify(data)}</span>`;
        })
        .catch(error => {
          output.innerHTML = `<span class="error">Promise chain failed: ${error.message}</span>`;
        });
    }

    function testPromiseAll() {
      const output = document.getElementById('promise-output');
      output.innerHTML = '<span class="loading">Testing Promise.all()...</span>';
      
      const promises = [
        createPromise(true, 1000),
        createPromise(true, 1500),
        createPromise(true, 800)
      ];
      
      Promise.all(promises)
        .then(results => {
          output.innerHTML = `<span class="success">All promises resolved: ${results.length} results</span>`;
          console.log('Promise.all results:', results);
        })
        .catch(error => {
          output.innerHTML = `<span class="error">Promise.all failed: ${error.message}</span>`;
        });
    }

    // 4. Async/Await
    async function testAsyncBasics() {
      const output = document.getElementById('async-output');
      output.innerHTML = '<span class="loading">Testing async/await...</span>';
      
      try {
        const result = await createPromise(true);
        output.innerHTML = `<span class="success">Async result: ${JSON.stringify(result)}</span>`;
      } catch (error) {
        output.innerHTML = `<span class="error">Async error: ${error.message}</span>`;
      }
    }

    async function testAsyncErrorHandling() {
      const output = document.getElementById('async-output');
      output.innerHTML = '<span class="loading">Testing async error handling...</span>';
      
      try {
        const result = await createPromise(false); // This will reject
        output.innerHTML = `<span class="success">This should not show: ${JSON.stringify(result)}</span>`;
      } catch (error) {
        output.innerHTML = `<span class="error">Caught async error: ${error.message}</span>`;
      }
    }

    async function testParallelExecution() {
      const output = document.getElementById('async-output');
      output.innerHTML = '<span class="loading">Testing parallel execution...</span>';
      
      const startTime = Date.now();
      
      try {
        // Sequential (slower)
        // const result1 = await createPromise(true, 1000);
        // const result2 = await createPromise(true, 1000);
        
        // Parallel (faster)
        const [result1, result2] = await Promise.all([
          createPromise(true, 1000),
          createPromise(true, 1000)
        ]);
        
        const endTime = Date.now();
        const duration = endTime - startTime;
        
        output.innerHTML = `
          <span class="success">Parallel execution completed in ${duration}ms</span><br>
          <small>Both promises executed in parallel, not sequentially</small>
        `;
      } catch (error) {
        output.innerHTML = `<span class="error">Parallel execution failed: ${error.message}</span>`;
      }
    }

    // 5. Fetch API
    async function testFetchBasics() {
      const output = document.getElementById('fetch-output');
      output.innerHTML = '<span class="loading">Fetching data...</span>';
      
      try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
        const data = await response.json();
        
        output.innerHTML = `
          <span class="success">Fetch successful!</span>
          <div class="api-result">${JSON.stringify(data, null, 2)}</div>
        `;
      } catch (error) {
        output.innerHTML = `<span class="error">Fetch error: ${error.message}</span>`;
      }
    }

    async function testFetchWithOptions() {
      const output = document.getElementById('fetch-output');
      output.innerHTML = '<span class="loading">Posting data...</span>';
      
      try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            title: 'Test Post',
            body: 'This is a test post',
            userId: 1
          })
        });
        
        const data = await response.json();
        
        output.innerHTML = `
          <span class="success">POST successful!</span>
          <div class="api-result">${JSON.stringify(data, null, 2)}</div>
        `;
      } catch (error) {
        output.innerHTML = `<span class="error">POST error: ${error.message}</span>`;
      }
    }

    async function testFetchErrorHandling() {
      const output = document.getElementById('fetch-output');
      output.innerHTML = '<span class="loading">Testing error handling...</span>';
      
      try {
        const response = await fetch('https://jsonplaceholder.typicode.com/posts/999999');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        output.innerHTML = `<span class="success">Data: ${JSON.stringify(data)}</span>`;
      } catch (error) {
        output.innerHTML = `<span class="error">Handled fetch error: ${error.message}</span>`;
      }
    }

    // 6. Real-world Example
    async function fetchUserData() {
      const userId = document.getElementById('user-id').value;
      const resultsDiv = document.getElementById('user-results');
      
      if (!userId) {
        resultsDiv.innerHTML = '<span class="error">Please enter a user ID</span>';
        return;
      }
      
      resultsDiv.innerHTML = '<span class="loading">Fetching user data...</span>';
      
      try {
        // Fetch user data and posts in parallel
        const [userResponse, postsResponse] = await Promise.all([
          fetch(`https://jsonplaceholder.typicode.com/users/${userId}`),
          fetch(`https://jsonplaceholder.typicode.com/users/${userId}/posts`)
        ]);
        
        if (!userResponse.ok || !postsResponse.ok) {
          throw new Error('User not found');
        }
        
        const user = await userResponse.json();
        const posts = await postsResponse.json();
        
        resultsDiv.innerHTML = `
          <div class="success">
            <h4>${user.name} (@${user.username})</h4>
            <p>Email: ${user.email}</p>
            <p>Phone: ${user.phone}</p>
            <p>Website: ${user.website}</p>
            <p><strong>Posts: ${posts.length}</strong></p>
            <details>
              <summary>Show Posts</summary>
              ${posts.map(post => `
                <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                  <strong>${post.title}</strong><br>
                  <small>${post.body}</small>
                </div>
              `).join('')}
            </details>
          </div>
        `;
        
      } catch (error) {
        resultsDiv.innerHTML = `<span class="error">Error: ${error.message}</span>`;
      }
    }

    async function fetchMultipleUsers() {
      const resultsDiv = document.getElementById('user-results');
      resultsDiv.innerHTML = '<span class="loading">Fetching multiple users...</span>';
      
      try {
        const userIds = [1, 2, 3];
        const userPromises = userIds.map(id => 
          fetch(`https://jsonplaceholder.typicode.com/users/${id}`)
            .then(response => response.json())
        );
        
        const users = await Promise.all(userPromises);
        
        resultsDiv.innerHTML = `
          <div class="success">
            <h4>Multiple Users:</h4>
            ${users.map(user => `
              <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                <strong>${user.name}</strong> - ${user.email}
              </div>
            `).join('')}
          </div>
        `;
        
      } catch (error) {
        resultsDiv.innerHTML = `<span class="error">Error: ${error.message}</span>`;
      }
    }

    // Initialize
    console.log('Async/Await examples loaded. Try the interactive buttons!');
  </script>
</body>
</html>